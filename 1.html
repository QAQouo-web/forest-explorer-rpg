<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£®æ—æ¢ç´¢å„€è¡¨æ¿ | Epic Text Adventure</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --p: #6366f1; --bg: #030712; --c: #111827; --t: #f3f4f6; --b: #374151; }
        body { background: var(--bg); color: var(--t); font-family: system-ui, -apple-system, sans-serif; margin: 0; padding: 20px; display: flex; justify-content: center; }
        #app { display: grid; grid-template-columns: 1fr 340px; gap: 24px; width: 100%; max-width: 1200px; height: 92vh; }
        
        /* éŠæˆ²ä¸»é¢æ¿ */
        .main-panel { background: var(--c); border-radius: 20px; padding: 30px; border: 1px solid var(--b); display: flex; flex-direction: column; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .log-box { flex-grow: 1; background: #000; border-radius: 12px; padding: 25px; overflow-y: auto; margin-bottom: 24px; border: 1px solid var(--b); scroll-behavior: smooth; }
        .msg { margin-bottom: 20px; line-height: 1.8; color: #9ca3af; font-size: 1.1rem; animation: fadeIn 0.5s ease forwards; }
        .msg-new { color: var(--p); border-left: 4px solid var(--p); padding-left: 15px; font-weight: 500; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* é¸é …æŒ‰éˆ• */
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn { background: #1f2937; color: #fff; border: 1px solid var(--b); padding: 18px; border-radius: 10px; cursor: pointer; text-align: left; transition: all 0.3s; font-size: 1rem; }
        .btn:hover { background: var(--p); transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3); }
        .btn-reset { grid-column: span 2; background: #4b5563; text-align: center; }

        /* å„€è¡¨æ¿ */
        .dash { background: var(--c); padding: 30px; border-radius: 20px; border: 1px solid var(--b); display: flex; flex-direction: column; align-items: center; }
        .chart-container { width: 100%; height: 250px; margin: 20px 0; }
        .prog-num { font-size: 3.5rem; font-weight: 900; color: var(--p); letter-spacing: -2px; }
        .node-info { font-size: 0.9rem; color: #6b7280; margin-top: 10px; background: #1f2937; padding: 5px 15px; border-radius: 20px; }
    </style>
</head>
<body>

<div id="app">
    <div class="main-panel">
        <div style="display:flex; justify-content:space-between; align-items:baseline; margin-bottom:15px;">
            <h2 style="margin:0; font-size: 1.8rem;">ğŸŒ³ è©›å’’çš„æ£®æ—</h2>
            <div class="node-info">ç•¶å‰å€åŸŸ: {{ currentId }}</div>
        </div>
        
        <div class="log-box" ref="scrollBox">
            <div v-for="(txt, i) in log" :key="i" :class="['msg', { 'msg-new': i === log.length-1 }]">
                {{ txt }}
            </div>
        </div>

        <div class="actions">
            <button v-for="opt in currentScene.options" class="btn" @click="move(opt.next)">
                â¤ {{ opt.text }}
            </button>
            <button v-if="!currentScene.options.length" class="btn btn-reset" @click="restart">
                ğŸ”„ é‡æ–°é€²å…¥æ£®æ— (ç´¯è¨ˆæ¢ç´¢é€²åº¦)
            </button>
        </div>
    </div>

    <div class="dash">
        <h3 style="margin:0;">å…¨åŸŸæ¢ç´¢é€²åº¦</h3>
        <div class="chart-container">
            <canvas id="progChart"></canvas>
        </div>
        <div class="prog-num">{{ progress }}%</div>
        <div style="text-align: left; width: 100%; margin-top: 20px; font-size: 0.85rem; color: #9ca3af;">
            <p>â— ç¸½å€åŸŸç¯€é»: {{ totalNodes }}</p>
            <p>â— å·²æ¨™è¨˜è·¯å¾‘: {{ exploredNodes.size }}</p>
            <hr style="border:0; border-top:1px solid var(--b); margin: 15px 0;">
            <p>æç¤ºï¼šå˜—è©¦ä¸åŒçš„é¸æ“‡ä¾†è§£é–éš±è—çš„ã€Œéºè·¡ã€èˆ‡ã€Œæ¹–æ³Šã€ç·šè·¯ã€‚åªæœ‰èµ°éæ‰€æœ‰åˆ†æ­§è·¯å¾‘æ‰èƒ½é”æˆ 100%ã€‚</p>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, nextTick } = Vue;

    createApp({
        setup() {
            const scrollBox = ref(null);
            const log = ref([]);
            const currentId = ref('entry');
            const exploredNodes = ref(new Set(['entry'])); // æŒä¹…åŒ–è¨˜éŒ„
            let chart = null;

            // --- å²è©©ç´šé•·æµç¨‹åŠ‡æœ¬ (25 å€‹å ´æ™¯ç¯€é») ---
            const story = {
                // ç¬¬ä¸€éšæ®µï¼šå…¥å£åˆ†æ­§
                entry: { text: "ä½ ç«™åœ¨è¢«è©›å’’çš„æ£®æ—é‚Šç·£ã€‚å‰æ–¹æœ‰å››æ¢é“è·¯ï¼Œæ¯ä¸€æ¢éƒ½é€šå¾€å®Œå…¨ä¸åŒçš„å‘½é‹ã€‚", options: [{text: "ç™»å‘å¯’å†·çš„åŒ—å¶º", next: "n_ridge"}, {text: "é€²å…¥ç¿ ç¶ çš„æ±è°·", next: "e_valley"}, {text: "çˆ¬å…¥å¤è€çš„æ¨¹æ ¹ç©´", next: "r_cave"}, {text: "èµ°å‘è’å»¢çš„è¥¿é©›ç«™", next: "w_station"}] },
                
                // åŒ—å¶ºç·šï¼šé«˜å±±èˆ‡ç‡ˆå¡”
                n_ridge: { text: "é«˜å±±ç©ºæ°£ç¨€è–„ï¼Œä½ ç™¼ç¾äº†ä¸€åº§è¢«å†°å°çš„åŠæ©‹ã€‚", options: [{text: "ä¿®å¾©ä¸¦è·¨è¶ŠåŠæ©‹", next: "n_bridge"}, {text: "æ²¿è‘—å±±è„Šå‘ä¸Šçˆ¬", next: "n_climb"}] },
                n_bridge: { text: "ä½ ä¾†åˆ°äº†ä¸€åº§å»¢æ£„ç‡ˆå¡”ï¼Œé€™è£¡å¯ä»¥ä¿¯ç°å…¨å¢ƒã€‚", options: [{text: "é»ç‡ƒç‡ˆå¡”è¨Šè™Ÿ", next: "n_signal"}] },
                n_climb: { text: "ä½ åœ¨å±±å·”ç™¼ç¾äº†å†°éœœå·¨äººçš„ç‹åº§ã€‚", options: [{text: "å‘ç‹åº§è‡´æ•¬", next: "altar"}] },
                n_signal: { text: "ç‡ˆå¡”ç‡ƒèµ·è—ç«ï¼Œç…§äº®äº†é€šå¾€ç¥­å£‡çš„æ·å¾‘ã€‚", options: [{text: "é †è‘—å…‰èŠ’èµ°", next: "altar"}] },
                
                // æ±è°·ç·šï¼šç²¾éˆèˆ‡ç€‘å¸ƒ
                e_valley: { text: "æ±è°·å……æ»¿äº†æœƒèªªè©±çš„è¢å…‰æ¤ç‰©ï¼Œå®ƒå€‘æ­£å¼•å°è‘—ä½ ã€‚", options: [{text: "è¿½éš¨ç™¼å…‰çš„é¹¿", next: "e_deer"}, {text: "æ¡æ‘˜ç¦å¿Œæœå¯¦", next: "e_fruit"}] },
                e_deer: { text: "é¹¿ç¾¤å¸¶ä½ ä¾†åˆ°éš±å¯†çš„ã€Œéœè¬æ¹–ç•”ã€ã€‚", options: [{text: "æ½›å…¥æ¹–åº•å®®æ®¿", next: "e_lake"}] },
                e_fruit: { text: "æœå¯¦è®“ä½ çœ‹ç©¿äº†ç¾å¯¦çš„è¿·éœ§ï¼Œç™¼ç¾äº†éš±è—è·¯å¾‘ã€‚", options: [{text: "èµ°å…¥è£‚ç¸«ä¸­", next: "e_void"}] },
                e_lake: { text: "æ¹–åº•å®®æ®¿ä¸­æœ‰ä¸€ä½å®ˆè­·è€…è´ˆèˆ‡ä½ æ£®æ—ä¹‹å¿ƒã€‚", options: [{text: "å¸¶è‘—å¿ƒå‰å¾€ä¸­å¤®", next: "altar"}] },
                e_void: { text: "ä½ åœ¨è™›ç©ºä¸­æ¼«æ­¥ï¼Œç›´æ¥ç©¿æ¢­åˆ°äº†ç¥­å£‡å¾Œæ–¹ã€‚", options: [{text: "ç¾èº«åœ¨ç¥­å£‡", next: "altar"}] },

                // åœ°åº•ç·šï¼šç¤¦å‘èˆ‡éºå€
                r_cave: { text: "åœ°åº•ä½ˆæ»¿äº†éŒ¯ç¶œè¤‡é›œçš„ç¤¦é“ï¼Œæ·±è™•å‚³ä¾†éµè»Œè²ã€‚", options: [{text: "æ­ä¹˜å»¢æ£„ç¤¦è»Š", next: "r_cart"}, {text: "æª¢æŸ¥ç‰†ä¸Šå£ç•«", next: "r_mural"}] },
                r_cart: { text: "ç¤¦è»Šåœ¨é»‘æš—ä¸­ç–¾é§›ï¼Œæœ€å¾Œæ’é€²äº†ä¸€åº§åœ°ä¸‹åœ–æ›¸é¤¨ã€‚", options: [{text: "é–±è®€ç¦æ›¸", next: "altar"}] },
                r_mural: { text: "å£ç•«æ­ç¤ºäº†æ£®æ—çš„æ­·å²ï¼Œä¸€æ¢å¯†é“ç·©ç·©é–‹å•Ÿã€‚", options: [{text: "èµ°å…¥å¯†é“", next: "altar"}] },

                // è¥¿é©›ç«™ç·šï¼šäººé¡æ®˜éª¸èˆ‡è¿·å¤±
                w_station: { text: "é©›ç«™å·²æˆå»¢å¢Ÿï¼Œå”¯æœ‰ä¸€åº§æ™‚é˜å¡”é‚„åœ¨é‹è½‰ã€‚", options: [{text: "èª¿æ•´é˜å¡”æŒ‡é‡", next: "w_clock"}, {text: "æœç´¢å»¢å¢Ÿåœ°ä¸‹å®¤", next: "w_basement"}] },
                w_clock: { text: "æ™‚é–“ä¼¼ä¹å€’æµäº†ï¼Œä½ å›åˆ°äº†æ£®æ—é‚„æœªè¢«è©›å’’å‰çš„æ¨£è²Œã€‚", options: [{text: "æ¼«æ­¥åœ¨æ˜”æ—¥æ—é“", next: "altar"}] },
                w_basement: { text: "ä½ åœ¨åœ°ä¸‹å®¤ç™¼ç¾äº†èˆŠåœ°åœ–ï¼Œæ¨™ç¤ºå‡ºåœ°å¿ƒçš„å…¥å£ã€‚", options: [{text: "é€²å…¥åœ°å¿ƒ", next: "altar"}] },

                // çµ‚å±€éšæ®µï¼šç¥­å£‡åŒ¯æµèˆ‡çµå±€
                altar: { text: "ä½ æŠµé”äº†æ£®æ—çš„æ ¸å¿ƒï¼šç¿¡ç¿ ç¥­å£‡ã€‚æ‰€æœ‰çš„å†’éšªåœ¨æ­¤åŒ¯èšã€‚ä½ æ„Ÿè¦ºåˆ°å¤§åœ°åœ¨é¡«æŠ–ï¼Œçµ‚å¹•å³å°‡æ‹‰é–‹ã€‚", options: [{text: "å•Ÿå‹•æ°¸æ†å¥‘ç´„", next: "end_a"}, {text: "æ‘§æ¯€æ±¡æŸ“æº", next: "end_b"}, {text: "èˆ‡æ£®æ—åˆç‚ºä¸€é«”", next: "end_c"}] },
                
                end_a: { text: "ä½ æˆç‚ºäº†æ£®æ—ä¹‹ç‹ï¼Œå’Œå¹³é™è‡¨äº†é€™ç‰‡åœŸåœ°ã€‚ä½ æ˜¯å‚³èªªä¸­çš„æ•‘ä¸–ä¸»ã€‚", options: [] },
                end_b: { text: "æ£®æ—æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å¹³å‡¡çš„å°é®ã€‚é›–ç„¶å¤±å»äº†é­”åŠ›ï¼Œä½†äººé¡é‡ç²è‡ªç”±ã€‚", options: [] },
                end_c: { text: "ä½ çš„è‚‰é«”åŒ–ä½œå¤§æ¨¹ï¼Œéˆé­‚åŒ–ä½œå¾®é¢¨ã€‚æ£®æ—å¾æ­¤æœ‰äº†æ–°çš„ç¥éˆã€‚", options: [] }
            };

            const totalNodes = Object.keys(story).length;
            const currentScene = computed(() => story[currentId.value]);
            const progress = computed(() => Math.round((exploredNodes.value.size / totalNodes) * 100));

            const initChart = () => {
                const ctx = document.getElementById('progChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['å·²è§£é–å€åŸŸ', 'å¾…å‹˜æ¢å€åŸŸ'],
                        datasets: [{
                            data: [1, totalNodes - 1],
                            backgroundColor: ['#6366f1', '#1f2937'],
                            borderWidth: 0,
                            hoverOffset: 0
                        }]
                    },
                    options: { 
                        cutout: '80%', 
                        plugins: { legend: { display: false } },
                        animation: { duration: 1000, easing: 'easeOutQuart' }
                    }
                });
            };

            const move = (id) => {
                currentId.value = id;
                exploredNodes.value.add(id);
                log.value.push(story[id].text);
                
                if (chart) {
                    chart.data.datasets[0].data = [exploredNodes.value.size, totalNodes - exploredNodes.value.size];
                    chart.update();
                }

                nextTick(() => { 
                    scrollBox.value.scrollTop = scrollBox.value.scrollHeight; 
                });
            };

            const restart = () => {
                currentId.value = 'entry';
                log.value = [story.entry.text];
                // æ ¸å¿ƒï¼šä¿ç•™ exploredNodes é›†åˆï¼Œå¯¦ç¾è·¨å‘¨ç›®é€²åº¦ç´¯è¨ˆ
            };

            onMounted(() => {
                log.value.push(story.entry.text);
                initChart();
            });

            return { log, currentId, currentScene, move, restart, scrollBox, progress, totalNodes, exploredNodes };
        }
    }).mount('#app');
</script>
</body>
</html>